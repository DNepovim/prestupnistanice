---
import { Image } from 'astro:assets'
import { getEntries, getEntry } from 'astro:content'

import ArrowLink from '../components/ArrowLink.astro'
import { routes } from '../routes'
import { tp } from '../utils/tp'

type Props = {
  class?: string
  slug: string
}

const { slug, class: className } = Astro.props

const entry = await getEntry('book', slug)

if (!entry) {
  return
}

const { data: b } = entry

const authors = await getEntries(
  b.authors.filter((a) => a.isMain && a.role.includes('author')).map((a) => a.slug),
)
---

<article class:list={['max-xs:flex max-xs:flex-col flex gap-8', className]}>
  {
    b.cover && (
      <a class="block w-[20rem] flex-1" href={routes.books.detail(slug)}>
        <Image
          alt={b.title}
          src={b.cover}
          width={157.5}
          height={157.5}
          class="border border-gray-200 shadow-2xl"
        />
      </a>
    )
  }
  <div class="flex flex-4 flex-col gap-4">
    <div class="max-sm:flex max-sm:flex-col">
      <h2
        style="-webkit-text-stroke-width: 1px; -webkit-text-stroke-color: var(--color-brand-first-500);"
        class="peer text-brand-second-100 font-head group text-shadow-lg relative inline text-5xl font-bold tracking-wide"
      >
        <a href={routes.books.detail(slug)}>{tp(b.title)}</a>
      </h2>
      <div class="relative mx-2 mb-2 inline-block w-8">
        <div
          class="absolute bottom-0 left-0 h-[1px] w-8 bg-gray-400 transition-all duration-500 peer-has-hover:-left-24 peer-has-hover:w-32 max-sm:hidden"
        >
        </div>
      </div>
      <p class="inline text-xl text-gray-500">
        {
          authors.map(({ data: a }, index) => (
            <span class="whitespace-nowrap">
              {index !== 0 ? ', ' : ''}
              <a
                class="group font-alt text-gray-500 transition-colors hover:text-black"
                href={routes.authors.detail(a.slug)}
              >
                {a.firstname} {a.surname}
              </a>
            </span>
          ))
        }
      </p>
    </div>

    <div class="min-sm:pl-8">
      <div class="line-clamp-3">
        {b.claim && tp(b.claim)}
      </div>
    </div>
    {
      (
        <div class="flex justify-end pr-4">
          <ArrowLink href={routes.books.detail(slug)}>v√≠ce o knize</ArrowLink>
        </div>
      )
    }
  </div>
</article>
