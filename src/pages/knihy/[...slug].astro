---
import { client } from "../../../tina/__generated__/client.ts";
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import { TinaMarkdown } from "tinacms/dist/rich-text";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("book");

  return posts.map((post) => ({
    params: { slug: post.id },
    props: {
      post,
      getTinaProps: async () =>
        client.queries.books({
          relativePath: post.data.tinaInfo?.relativePath ?? "",
        }),
    },
  }));
}

const { slug } = Astro.params;

const relativePath = `${slug}.md`;
const res = await client.queries.books({ relativePath });
const book = res.data.books;
const authors = (book.authors ?? []).filter((a) => a?.role === "author");
---

<Layout bgColor={book.bgColor ?? undefined}>
  <h1
    class="mt-6 mb-6 font-head text-8xl"
    style={{ color: book.color ?? "black" }}
  >
    {book.title}
  </h1>

  <p class="text-2xl  mb-8">
    {
      authors.map((a, index) => (
        <span class="whitespace-nowrap">
          {index !== 0 ? ", " : ""}
          <a
            class="group text-gray-500 hover:text-black transition-colors font-alt"
            href={`/autori/${a?.author?._sys.filename}`}
          >
            {a?.author?.firstname} {a?.author?.surname}
          </a>
        </span>
      ))
    }
  </p>
  {
    book.cover && (
      <Image
        alt={book.title}
        src={book.cover as string}
        width={420}
        height={600}
        class="float-left shadow-2xl border border-gray-200 -translate-x-8"
      />
    )
  }
  <TinaMarkdown
    content={book.description}
  />
  
</Layout>
